# Aladdin DAO F(x) Contracts

### What is Concentrator?

Concentrator is a yield enhancement product by AladdinDAO built for smart farmers who wish to use their Convex LP assets to farm top-tier DeFi tokens (CRV, CVX) at the highest APY possible. Increase your yields on Convex farms by the CRV staking pool APY.

### How does it work?

Farmers deposit their Convex vault LP tokens in Concentrator. Yields from those vaults are harvested, swapped to CRV and then staked on behalf of the farmer in the Convex CRV vault where they autocompound. Users may withdraw any or all of their deposit and yield at any time in CRV or (zap to) CVX!

### Is it an autocompounder?

An autocompounder generally sells all farming rewards for a vault in order to buy more of the deposited token. The APY is generated by compounding the base rate, but the base rate for the yield is the same as that for the bulk deposit. Gains are realized continuously rather than at a time chosen by the farmer.

Concentrator can capture rewards from deposits in multiple different Convex vaults and merge them into CRV where they take advantage of the high CRV staking rate on Convex. Yields auto-compound at this higher rate, denominated in a top-tier DeFi token (CRV) and gains can be realized/claimed in CRV or CVX at a time chosen by the farmer for maximum tax advantage.

### Is it safe?

Concentrator is built by the experienced and security-obsessed AladdinDAO team, and it is audited by SECBIT Labs.

Check out the audit [here](./audit-reports/SECBIT_Concentrator_Report.pdf).

## Development

### install dependency

install yarn

```
yarn install
```

### compile contract

```
yarn hardhat compile
```

### unit test

```
yarn hardhat test
```

### visual studio code

add the following extensions:

- Markdown Preview Mermaid Support (for the diagrams in readme.md)
- vscode-pdf (to see the whitepapers)
- Solidity (nomic foundation one)

## Contract relationships

```mermaid
---
title: f(x) contracts and relationships
---
classDiagram
  class ERC20{
    +name
    +symbol
    +totalSupply
  }

  class FXVault{
    +fxRatio
    +totalFxToken
    +totalLpToken
    +deposit()
    +redeem()
    #rebalance()
    #updateWrapper()
  }

  note for FXVault "lpToken"
  note for FXVault "fxToken"
  note for FXVault "wrapper"

  class Treasury
  class HarvestableTreasury{
    +harvestBountyRatio
    +stabilityPoolRatio
    +harvest()
    #updateStabilityPool()
    #updateRewardRatio()
  }
  HarvestableTreasury --|> Treasury
  note for HarvestableTreasury "platform"
  note for HarvestableTreasury "stabilityPool"

  class FractionalToken{
    +nav
  }
  FractionalToken ..> Treasury
  FractionalToken --|> ERC20

```

## Deployment

see: [Deployments](https://github.com/AladdinDAO/deployments).

```mermaid
---
title: Aladdin f(x) deployed contracts and relationships (Dec-2023)
---
flowchart TB

  %% contracts and their addressses
  tsy(stETHTreasury):::contract
  click tsy "https://etherscan.io/address/0x1951Fb29Ee3ED3026ED7cE2BEEE3194D90fBB2Bc"

  ftn(FractionalToken):::contract
  click ftn "https://etherscan.io/address/0x2a906eab9b088e6753670bc8d3840f9473745748"

  xtn(LeveragedToken):::contract
  click xtn "https://etherscan.io/address/0x92d0cb7E56806Bf977e7F5296EA2Fe84B475Fe83"

  %%p-mar["MarketProxy"]:::proxy
  %%click p-mar "https://etherscan.io/address/0xe7b9c7c9cA85340b8c06fb805f7775e3015108dB"
  %%p-mar -.-> mar
  mar("Market"):::contract
%% docs: click mar "https://etherscan.io/address/0x31bfAf256875A93B5D02Cdef80B17EF780663D81"
  click mar "https://etherscan.io/address/0x679de4a3836d916fc86c6d9944c98a694f68adb4"

  rbp("RebalancePool"):::contract
  click rbp "https://etherscan.io/address/0x3415fcD2885C486E2d848403d51077f7176473C7"

  wst(wstETHWrapper):::contract
  click wst "https://etherscan.io/address/0xb09e34dD25d5E88a1E9Ff6F6418109927675B658"

  rvp["ReservePool"]:::contract
  click rvp "https://etherscan.io/address/0x5d0Aacf75116d1645Db2B3d1Ca4b303ef0CA3752"

  rbpwb("RebalanceWithBonusToken"):::contract
  click rbpwt "https://etherscan.io/address/0x17f21f468d77E6e35702a9Ae7a9da50Db7F6a4f4"


  %% links between contracts
  tsy-fractionalToken(fractionalToken):::link

  tsy ---tsy-fractionalToken--> ftn





  classDef contract font:11px Roboto
  classDef proxy fill:#ffffff,font:11px Roboto
  classDef link stroke-width:0px,fill:#ffffff,font:11px Roboto


```

"stETHGateway": "0x9bF5fFABbF97De0a47843A7Ba0A9DDB40f2e2ed5",
"ChainlinkTwapOracle": {
"ETH": "0x460B3CdE57DfbA90DBed02fd83d3990a92DA1230",
"stETH": "0xD24AC180e6769Fd5F624e7605B93084171074A77"
},
"FxETHTwapOracle": "0xa84360896cE9152d1780c546305BB54125F962d9",
"FxGateway": "0x49e51067E695bd79d6275eCaB6E9E527a72AbdE4",
"ReservePool": "0x5d0Aacf75116d1645Db2B3d1Ca4b303ef0CA3752",
"RebalanceWithBonusToken": "0x17f21f468d77E6e35702a9Ae7a9da50Db7F6a4f4"
}
